plugins {
    id 'application'
    id 'org.graalvm.buildtools.native' version '0.9.13'
}

repositories {
    mavenCentral()
}

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
}

application {
    mainClass = 'graal.filter.test.App'
}

tasks.named('test') {
    useJUnitPlatform()
}

graalvmNative {
  agent {
    defaultMode = "conditional"
    modes {
      conditional {
        userCodeFilterPath = "user-code-filter.json"
      }
    }
	callerFilterFiles.from("caller-filter.json")
	accessFilterFiles.from("access-filter.json")
    metadataCopy {
      mergeWithExisting = true
      inputTaskNames.add("test")
      outputDirectories.add("src/main/resources/META-INF/native-image/graal-filter-test/graal-filter-test")
    }
  }

  binaries {
	main {
		quickBuild = true
    }
  }
}
